# Redis


## 캐시란
cache란 사용자의 입장에서
데이터의 원래 소스보다 더 빠르게
그리고 더 효율적으로 액세스할 수 있는
임시 데이터 저장소를 뜻한다. 대부분의 애플리케이션에서
속도 향상을 위해 cache를 사용하고 있다. 캐시에 데이터나 계산된 결과 값의 복사본을 저장해 둠으로써 전체적인 처리 속도를 향상시킨다.

캐시를 사용하는 경우는 다음과 같다.
- 데이터에 직접적으로 접근하는 데 걸리는 시간이 오래 걸릴 때
- 데이터가 잘 변하지 않는 경우
- 반복적으로 동일한 결과를 돌려주는 경우 (이미지와 썸네일 등)

## Redis란
레디스는 전 세계에서 가장 유명한 caching 솔루션이다. 
단순하게 key-value 형태로 저장할 수 있기 때문에
어떤 데이터라도 쉽게 저장할 수 있다.
또한 레디스는 모든 데이터를 메모리에 올려두는
인메모리 데이터 스토어이다. 평균 읽기 및 쓰기 작업 속도가 1밀리 세컨드 미만이니
초당 수백만 건의 작업이 가능하다.

## 캐싱 전략
레디스를 cache로 사용할 때 어떻게 배치하는지가
시스템의 성능에 큰 영향을 끼치기 때문에 caching 전략은 데이터의 유형과
해당 데이터에 대한 액세스 패턴을
잘 고려해서 선택해야 한다.

### 읽기 전략
#### Look-Aside(Lazy Loading)

![image](https://user-images.githubusercontent.com/46465928/155972216-4987faf5-f907-404e-a524-af36f5fc3263.png)

이 구조는 레디스를 cache로 쓸 때
가장 일반적으로 사용하는 방법이다.
애플리케이션은 데이터를 찾을 때
cache에 먼저 확인한다.
cache에 데이터가 있으면
cache에서 데이터를 가지고 오는 작업을 반복한다.

![image](https://user-images.githubusercontent.com/46465928/155972267-b4eecc8a-348b-4bca-8bd9-d812ace81ada.png)


만약 레디스에 찾는 키가 없다면
애플리케이션은 DB에 접근해서
데이터를 직접 가지고 온 뒤
다시 레디스에 저장하는 과정을 거쳐야 한다.
따라서 cache는 찾는 데이터가 없을 때에만 입력되기 때문에
이를 lazy loading이라고도 부른다.
이 구조는 레디스가 다운되더라도 바로 장애로 이어지지 않고
DB에서 데이터를 가지고 올 수 있다.
대신 cache로 붙어있던 커넥션이 많이 있었다면
그 커넥션이 모두 데이터베이스로 붙기 때문에
DB에 갑자기 많은 부하가 몰릴 수 있다.
그래서 이런 경우에 cache를 새로 투입하거나
DB에만 새로운 데이터를 저장했다면
처음에 캐시 미스가 엄청 발생해서
성능에 저하가 올 수 있다.
이럴 때에는 미리 DB에서 cache로
데이터를 밀어 넣어주는 작업을 할 수 있는데,
이를 cache warming이라고도 한다.

### 쓰기 전략
#### Write-Around

![image](https://user-images.githubusercontent.com/46465928/155972106-e45061a4-4344-4878-b109-c3f4e3a21ca2.png)

write around 방식은 DB에만 데이터를 저장한다.
일단 모든 데이터는 DB에 저장되고
cache miss가 발생한 경우에만
cache에 데이터를 끌어오게 된다.
이 경우엔 cahce 내의 데이터와 DB 내의 데이터가
다를 수 있다는 단점이 있다.

#### Write-Through

![image](https://user-images.githubusercontent.com/46465928/155972155-63958058-94be-4a8c-a158-bc6f53533924.png)

write-through 전략은
DB에 데이터를 저장할 때
cache에도 함께 저장하는 방법이다.
cache는 항상 최신 정보를 가지고 있다는 장점이 있지만
저장할 때마다 두 단계 스텝을 거쳐야 하기 때문에
상대적으로 느리다고 볼 수 있다.
그리고 저장하는 데이터가 재사용되지 않을 수도 있는데
무조건 캐시에 넣어버리기 때문에
이는 일종의 리소스 낭비라고도 볼 수 있다.
따라서 이렇게 데이터를 저장할 때는 몇 분
혹은 몇 시간 동안만 데이터를 보관하겠다는 의미인
expire time을 설정해 주는 것이 좋다.

## 출처
https://youtu.be/92NizoBL4uA



